<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Applying cohort table requirements</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Applying cohort table requirements</h1>



<p>In this vignette we’ll show how requirements related to the data
contained in the cohort table can be applied. For this we’ll use the
Eunomia synthetic data.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(omock)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">library</span>(CodelistGenerator)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">library</span>(CohortConstructor)</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="fu">library</span>(CohortCharacteristics)</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>cdm <span class="ot">&lt;-</span> <span class="fu">mockCdmFromDataset</span>(<span class="at">datasetName =</span> <span class="st">&quot;GiBleed&quot;</span>, <span class="at">source =</span> <span class="st">&quot;duckdb&quot;</span>)</span></code></pre></div>
<p>Let’s start by creating a cohort of acetaminophen users. Individuals
will have a cohort entry for each drug exposure record they have for
acetaminophen with cohort exit based on their drug record end date. Note
when creating the cohort, any overlapping records will be
concatenated.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>acetaminophen_codes <span class="ot">&lt;-</span> <span class="fu">getDrugIngredientCodes</span>(cdm, </span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>                                              <span class="at">name =</span> <span class="st">&quot;acetaminophen&quot;</span>, </span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>                                              <span class="at">nameStyle =</span> <span class="st">&quot;{concept_name}&quot;</span>)</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>cdm<span class="sc">$</span>acetaminophen <span class="ot">&lt;-</span> <span class="fu">conceptCohort</span>(<span class="at">cdm =</span> cdm, </span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>                                   <span class="at">conceptSet =</span> acetaminophen_codes, </span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>                                   <span class="at">exit =</span> <span class="st">&quot;event_end_date&quot;</span>,</span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>                                   <span class="at">name =</span> <span class="st">&quot;acetaminophen&quot;</span>)</span></code></pre></div>
<p>At this point we have just created our base cohort without having
applied any restrictions. To visualise the current state of the cohort,
we can use the <code>summariseCohortAttrition()</code> function to
summarise attrition and then plot the results using
<code>plotCohortAttrition()</code>.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>summary_attrition <span class="ot">&lt;-</span> <span class="fu">summariseCohortAttrition</span>(cdm<span class="sc">$</span>acetaminophen)</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="fu">plotCohortAttrition</span>(summary_attrition)</span></code></pre></div>
<div id="keep-only-the-first-record-per-person" class="section level2">
<h2>Keep only the first record per person</h2>
<p>We can see that in our starting cohort individuals have multiple
entries for each use of acetaminophen. However, we could keep only their
earliest cohort entry by using <code>requireIsFirstEntry()</code> from
CohortConstructor.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>cdm<span class="sc">$</span>acetaminophen <span class="ot">&lt;-</span> cdm<span class="sc">$</span>acetaminophen <span class="sc">|&gt;</span> </span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>  <span class="fu">requireIsFirstEntry</span>()</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>summary_attrition <span class="ot">&lt;-</span> <span class="fu">summariseCohortAttrition</span>(cdm<span class="sc">$</span>acetaminophen)</span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a><span class="fu">plotCohortAttrition</span>(summary_attrition)</span></code></pre></div>
<p>While the number of individuals remains unchanged, records after an
individual’s first have been excluded.</p>
</div>
<div id="keep-only-the-last-record-per-person" class="section level2">
<h2>Keep only the last record per person</h2>
<p>If we want to require cohort entries to last a specific amount of
time then we can use <code>requireDuration()</code>. Here for example we
create an acetaminophen cohort and keep only those records that last for
at least 30 days.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>cdm<span class="sc">$</span>acetaminophen <span class="ot">&lt;-</span> <span class="fu">conceptCohort</span>(<span class="at">cdm =</span> cdm, </span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>                                   <span class="at">conceptSet =</span> acetaminophen_codes, </span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>                                   <span class="at">exit =</span> <span class="st">&quot;event_end_date&quot;</span>,</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>                                   <span class="at">name =</span> <span class="st">&quot;acetaminophen&quot;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>  <span class="fu">requireDuration</span>(<span class="fu">c</span>(<span class="dv">30</span>, <span class="cn">Inf</span>))</span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a>summary_attrition <span class="ot">&lt;-</span> <span class="fu">summariseCohortAttrition</span>(cdm<span class="sc">$</span>acetaminophen)</span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a><span class="fu">plotCohortAttrition</span>(summary_attrition)</span></code></pre></div>
</div>
<div id="keep-only-a-range-of-records-per-person" class="section level2">
<h2>Keep only a range of records per person</h2>
<p>If we want to keep only a specific range of records per person, we
can use the <code>requireIsEntry()</code> function. For example, o keep
only the first two entries for each person, we can set
<code>entryRange = c(1, 2)</code>.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>cdm<span class="sc">$</span>acetaminophen <span class="ot">&lt;-</span> <span class="fu">conceptCohort</span>(<span class="at">cdm =</span> cdm, </span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>                                   <span class="at">conceptSet =</span> acetaminophen_codes, </span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>                                   <span class="at">exit =</span> <span class="st">&quot;event_end_date&quot;</span>,</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>                                   <span class="at">name =</span> <span class="st">&quot;acetaminophen&quot;</span>)</span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>cdm<span class="sc">$</span>acetaminophen <span class="ot">&lt;-</span> cdm<span class="sc">$</span>acetaminophen <span class="sc">|&gt;</span> </span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>  <span class="fu">requireIsEntry</span>(<span class="at">entryRange =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a>summary_attrition <span class="ot">&lt;-</span> <span class="fu">summariseCohortAttrition</span>(cdm<span class="sc">$</span>acetaminophen)</span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a><span class="fu">plotCohortAttrition</span>(summary_attrition)</span></code></pre></div>
</div>
<div id="keep-only-records-within-a-date-range" class="section level2">
<h2>Keep only records within a date range</h2>
<p>Individuals may contribute multiple records over extended periods. We
can filter out records that fall outside a specified date range using
the <code>requireInDateRange</code> function.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>cdm<span class="sc">$</span>acetaminophen <span class="ot">&lt;-</span> <span class="fu">conceptCohort</span>(<span class="at">cdm =</span> cdm, </span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>                                 <span class="at">conceptSet =</span> acetaminophen_codes, </span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>                                 <span class="at">name =</span> <span class="st">&quot;acetaminophen&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>cdm<span class="sc">$</span>acetaminophen <span class="ot">&lt;-</span> cdm<span class="sc">$</span>acetaminophen <span class="sc">|&gt;</span> </span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>  <span class="fu">requireInDateRange</span>(<span class="at">dateRange =</span> <span class="fu">as.Date</span>(<span class="fu">c</span>(<span class="st">&quot;2010-01-01&quot;</span>, <span class="st">&quot;2015-01-01&quot;</span>)))</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>summary_attrition <span class="ot">&lt;-</span> <span class="fu">summariseCohortAttrition</span>(cdm<span class="sc">$</span>acetaminophen)</span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a><span class="fu">plotCohortAttrition</span>(summary_attrition)</span></code></pre></div>
</div>
<div id="keep-only-if-entry-lasts-a-given-duration" class="section level2">
<h2>Keep only if entry lasts a given duration</h2>
<p>Let’s create an acetaminophen cohort again.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>cdm<span class="sc">$</span>acetaminophen <span class="ot">&lt;-</span> <span class="fu">conceptCohort</span>(<span class="at">cdm =</span> cdm, </span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>                                 <span class="at">conceptSet =</span> acetaminophen_codes, </span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>                                 <span class="at">name =</span> <span class="st">&quot;acetaminophen&quot;</span>)</span></code></pre></div>
<p>If people on start and stop on the same day they will be considered
to be in the cohort for one day. So to require them to have been in the
cohort until at least the day after cohort start we can use the
<code>requireDuration</code> function. Here we’ll create a new cohort
table and then bind our original and new cohorts so that we can see the
impact of this requirement.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a>cdm<span class="sc">$</span>acetaminophen_one_night <span class="ot">&lt;-</span> cdm<span class="sc">$</span>acetaminophen <span class="sc">|&gt;</span> </span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>  <span class="fu">requireDuration</span>(<span class="fu">c</span>(<span class="dv">2</span>, <span class="cn">Inf</span>), </span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>                  <span class="at">name =</span> <span class="st">&quot;acetaminophen_one_night&quot;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>  <span class="fu">renameCohort</span>(<span class="st">&quot;acetaminophen_one_night&quot;</span>)</span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a>cdm <span class="ot">&lt;-</span> <span class="fu">bind</span>(cdm<span class="sc">$</span>acetaminophen,</span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a>            cdm<span class="sc">$</span>acetaminophen_one_night, </span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a>            <span class="at">name =</span> <span class="st">&quot;both_cohorts&quot;</span>)</span></code></pre></div>
<p>Now when summarising days in cohort we can see the difference this
makes.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a>summary_attrition <span class="ot">&lt;-</span> <span class="fu">summariseCohortAttrition</span>(cdm<span class="sc">$</span>both_cohorts)</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="fu">plotCohortAttrition</span>(summary_attrition)</span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a>summary_characteristics <span class="ot">&lt;-</span> <span class="fu">summariseCharacteristics</span>(cdm<span class="sc">$</span>both_cohorts)</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a><span class="fu">tableCharacteristics</span>(summary_characteristics <span class="sc">|&gt;</span></span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a>                       <span class="fu">filter</span>(variable_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Number subjects&quot;</span>, <span class="st">&quot;Days in cohort&quot;</span>)))</span></code></pre></div>
</div>
<div id="applying-multiple-cohort-requirements" class="section level2">
<h2>Applying multiple cohort requirements</h2>
<p>Multiple restrictions can be applied to a cohort, however it is
important to note that the order that requirements are applied will
often matter.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a>cdm<span class="sc">$</span>acetaminophen_1 <span class="ot">&lt;-</span> <span class="fu">conceptCohort</span>(<span class="at">cdm =</span> cdm, </span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>                                 <span class="at">conceptSet =</span> acetaminophen_codes, </span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a>                                 <span class="at">name =</span> <span class="st">&quot;acetaminophen_1&quot;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a>  <span class="fu">requireIsFirstEntry</span>() <span class="sc">|&gt;</span></span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a>  <span class="fu">requireInDateRange</span>(<span class="at">dateRange =</span> <span class="fu">as.Date</span>(<span class="fu">c</span>(<span class="st">&quot;2010-01-01&quot;</span>, <span class="st">&quot;2016-01-01&quot;</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a>  <span class="fu">renameCohort</span>(<span class="st">&quot;entry_before_date&quot;</span>)</span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a>cdm<span class="sc">$</span>acetaminophen_2 <span class="ot">&lt;-</span> <span class="fu">conceptCohort</span>(<span class="at">cdm =</span> cdm, </span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a>                                 <span class="at">conceptSet =</span> acetaminophen_codes, </span>
<span id="cb14-10"><a href="#cb14-10" tabindex="-1"></a>                                 <span class="at">name =</span> <span class="st">&quot;acetaminophen_2&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb14-11"><a href="#cb14-11" tabindex="-1"></a>  <span class="fu">requireInDateRange</span>(<span class="at">dateRange =</span> <span class="fu">as.Date</span>(<span class="fu">c</span>(<span class="st">&quot;2010-01-01&quot;</span>, <span class="st">&quot;2016-01-01&quot;</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb14-12"><a href="#cb14-12" tabindex="-1"></a>  <span class="fu">requireIsFirstEntry</span>(<span class="st">&quot;date_before_entry&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a>cdm <span class="ot">&lt;-</span> <span class="fu">bind</span>(cdm<span class="sc">$</span>acetaminophen_1,</span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a>            cdm<span class="sc">$</span>acetaminophen_2, </span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a>            <span class="at">name =</span> <span class="st">&quot;both_cohorts&quot;</span>)</span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a>summary_attrition <span class="ot">&lt;-</span> <span class="fu">summariseCohortAttrition</span>(cdm<span class="sc">$</span>both_cohorts)</span></code></pre></div>
<p>If we apply our entry requirement before our date requirement then we
have a cohort of people with their first ever record of acetaminophen
which occurs in our study period. But if we apply our date requirement
before our entry requirement we have a cohort of people with their first
record of acetaminophen in the study period, but this will not
necessarily be their first record ever.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="fu">plotCohortAttrition</span>(summary_attrition)</span></code></pre></div>
</div>
<div id="keep-only-records-from-cohorts-with-a-minimum-number-of-individuals" class="section level2">
<h2>Keep only records from cohorts with a minimum number of
individuals</h2>
<p>Another useful functionality, particularly when working with multiple
cohorts or performing a network study, is provided by
<code>requireMinCohortCount</code>. Here we will only keep cohorts with
a minimum count, filtering out records from cohorts with fewer than this
number.</p>
<p>As an example let’s create a cohort for every drug ingredient we see
in Eunomia. We can first get the drug ingredient codes.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a>medication_codes <span class="ot">&lt;-</span> <span class="fu">getDrugIngredientCodes</span>(<span class="at">cdm =</span> cdm, <span class="at">nameStyle =</span> <span class="st">&quot;{concept_name}&quot;</span>)</span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>medication_codes</span></code></pre></div>
<p>We can see that when we make all these cohorts many have only a small
number of individuals.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a>cdm<span class="sc">$</span>medications <span class="ot">&lt;-</span> <span class="fu">conceptCohort</span>(<span class="at">cdm =</span> cdm, </span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a>                                 <span class="at">conceptSet =</span> medication_codes,</span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a>                                 <span class="at">name =</span> <span class="st">&quot;medications&quot;</span>)</span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" tabindex="-1"></a><span class="fu">cohortCount</span>(cdm<span class="sc">$</span>medications) <span class="sc">|&gt;</span> </span>
<span id="cb18-7"><a href="#cb18-7" tabindex="-1"></a>  <span class="fu">filter</span>(number_subjects <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">|&gt;</span> </span>
<span id="cb18-8"><a href="#cb18-8" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb18-9"><a href="#cb18-9" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(number_subjects),</span>
<span id="cb18-10"><a href="#cb18-10" tabindex="-1"></a>                 <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb18-11"><a href="#cb18-11" tabindex="-1"></a>                 <span class="at">binwidth =</span> <span class="dv">25</span>) <span class="sc">+</span>  </span>
<span id="cb18-12"><a href="#cb18-12" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Number of subjects&quot;</span>) <span class="sc">+</span></span>
<span id="cb18-13"><a href="#cb18-13" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p>If we apply a minimum cohort count of 500, we end up with far fewer
cohorts that all have a sufficient number of study participants.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a>cdm<span class="sc">$</span>medications <span class="ot">&lt;-</span> cdm<span class="sc">$</span>medications <span class="sc">|&gt;</span> </span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a>  <span class="fu">requireMinCohortCount</span>(<span class="at">minCohortCount =</span> <span class="dv">500</span>)</span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a><span class="fu">cohortCount</span>(cdm<span class="sc">$</span>medications) <span class="sc">|&gt;</span> </span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a>  <span class="fu">filter</span>(number_subjects <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">|&gt;</span> </span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb19-7"><a href="#cb19-7" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(number_subjects),</span>
<span id="cb19-8"><a href="#cb19-8" tabindex="-1"></a>                 <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb19-9"><a href="#cb19-9" tabindex="-1"></a>                 <span class="at">binwidth =</span> <span class="dv">25</span>) <span class="sc">+</span> </span>
<span id="cb19-10"><a href="#cb19-10" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>, <span class="cn">NA</span>) <span class="sc">+</span> </span>
<span id="cb19-11"><a href="#cb19-11" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Number of subjects&quot;</span>) <span class="sc">+</span></span>
<span id="cb19-12"><a href="#cb19-12" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
